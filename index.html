<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro de Ventas - Panader√≠a</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ü•ñ Registro de Ventas - Panader√≠a</h1>
            <p class="fecha" id="fecha"></p>
        </header>

        <div class="main-content">
            <!-- Productos -->
            <section class="productos-section">
                <div id="categoriasTabs" class="categorias-tabs"></div>
                <div class="productos-grid" id="productosGrid"></div>
            </section>

            <!-- Carrito y Pago -->
            <section class="carrito-section">
                <div class="carrito">
                    <h2>Carrito de Compra</h2>
                    <div id="carritoItems" class="carrito-items"></div>
                    <div class="carrito-total">
                        <h3>Total: $<span id="totalCarrito">0.00</span></h3>
                    </div>
                    <button class="btn-limpiar" onclick="limpiarCarrito()">Limpiar Carrito</button>
                </div>

                <div class="pago">
                    <h2>M√©todo de Pago</h2>
                    <div class="metodo-pago">
                        <button class="btn-pago" onclick="seleccionarMetodo('tarjeta')">üí≥ Tarjeta</button>
                        <button class="btn-pago" onclick="seleccionarMetodo('efectivo')">üíµ Efectivo</button>
                    </div>
                </div>

                <div class="admin">
                    <h2>‚öôÔ∏è Administraci√≥n</h2>
                    <button class="btn-admin" onclick="abrirModalVentaManual()">üí∞ Venta Manual</button>
                    <button class="btn-admin" onclick="abrirModalProductos()">Ver Productos</button>
                    <button class="btn-admin" onclick="abrirModalReporte()">Ver Reporte</button>
                    <button class="btn-admin" onclick="abrirModalRetiro()">üí∏ Retirar Efectivo</button>
                </div>
            </section>
        </div>
    </div>

    <!-- Modal Reporte -->
    <div id="modalReporte" class="modal hidden">
        <div class="modal-content modal-reporte">
            <div class="modal-header">
                <h2>üìä Reporte del D√≠a</h2>
                <span class="modal-close" onclick="cerrarModalReporte()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="reporte-header">
                    <div class="navegacion-fecha">
                        <button class="btn-fecha-nav" onclick="cambiarDiaReporte(-1)">‚óÄ</button>
                        <h3 id="reporteFechaModal"></h3>
                        <button class="btn-fecha-nav" onclick="cambiarDiaReporte(1)">‚ñ∂</button>
                    </div>
                </div>
                
                <div class="reporte-seccion">
                    <h4>Productos Vendidos</h4>
                    <div id="reporteProductos" class="reporte-productos"></div>
                </div>
                
                <div class="reporte-seccion">
                    <h4>Resumen de Ventas</h4>
                    <div class="reporte-resumen">
                        <div class="resumen-item">
                            <span>üí≥ Ventas con Tarjeta:</span>
                            <strong>$<span id="reporteTarjeta">0.00</span></strong>
                        </div>
                        <div class="resumen-item">
                            <span>üíµ Ventas en Efectivo:</span>
                            <strong>$<span id="reporteEfectivo">0.00</span></strong>
                        </div>
                        <div class="resumen-item resumen-total">
                            <span>üí∞ Total del D√≠a:</span>
                            <strong class="total-amount">$<span id="reporteTotalModal">0.00</span></strong>
                        </div>
                        <div class="resumen-item">
                            <span>üßæ Transacciones:</span>
                            <strong><span id="reporteTransaccionesModal">0</span></strong>
                        </div>
                    </div>
                </div>
                
                <div class="reporte-seccion">
                    <h4>üí∏ Retiros de Efectivo</h4>
                    <div id="reporteRetiros" class="reporte-retiros"></div>
                </div>
                
                <button class="btn-descargar-modal" onclick="descargarReporte()">Descargar Reporte</button>
            </div>
        </div>
    </div>

    <!-- Modal Productos -->
    <div id="modalProductos" class="modal hidden">
        <div class="modal-content modal-productos">
            <div class="modal-header">
                <h2>üì¶ Base de Datos de Productos</h2>
                <span class="modal-close" onclick="cerrarModalProductos()">&times;</span>
            </div>
            <div class="modal-body">
                <div style="display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap;">
                    <button class="btn-agregar-producto" onclick="mostrarFormularioProducto()">+ Agregar Producto</button>
                    <button class="btn-agregar-producto" onclick="toggleGestionCategorias()">‚öôÔ∏è Gestionar Categor√≠as</button>
                    <button class="btn-agregar-producto" onclick="document.getElementById('csvInput').click()">üìÑ Importar CSV</button>
                    <input type="file" id="csvInput" accept=".csv" style="display: none;" onchange="importarCSV(event)">
                </div>
                
                <!-- Gesti√≥n de Categor√≠as -->
                <div id="gestionCategorias" class="gestion-categorias hidden">
                    <h3 style="margin-bottom: 15px;">Gesti√≥n de Categor√≠as</h3>
                    
                    <div id="formularioCategoria" class="formulario-producto hidden">
                        <h4 id="tituloCategoriaForm">Nueva Categor√≠a</h4>
                        <input type="hidden" id="categoriaKeyEdit">
                        <div class="form-group">
                            <label>Clave (ID interno):</label>
                            <input type="text" id="categoriaKey" placeholder="ej: postres" pattern="[a-zA-Z]+">
                        </div>
                        <div class="form-group">
                            <label>Nombre a mostrar:</label>
                            <input type="text" id="categoriaNombre" placeholder="ej: Postres">
                        </div>
                        <div class="form-group">
                            <label>Color:</label>
                            <input type="color" id="categoriaColor" value="#9b59b6">
                        </div>
                        <div class="form-buttons">
                            <button class="btn-cancelar" onclick="cancelarFormularioCategoria()">Cancelar</button>
                            <button class="btn-guardar" onclick="guardarCategoria()">Guardar</button>
                        </div>
                    </div>
                    
                    <button class="btn-agregar-producto" onclick="mostrarFormularioCategoria()" style="margin-bottom: 15px;">+ Nueva Categor√≠a</button>
                    
                    <div class="categorias-lista" id="categoriasLista"></div>
                    <hr style="margin: 20px 0; border: 1px solid #eee;">
                </div>
                
                <div id="formularioProducto" class="formulario-producto hidden">
                    <h4 id="tituloFormulario">Nuevo Producto</h4>
                    <input type="hidden" id="productoIdEdit">
                    <div class="form-group">
                        <label>Nombre:</label>
                        <input type="text" id="productoNombre" placeholder="Nombre del producto">
                    </div>
                    <div class="form-group">
                        <label>Precio:</label>
                        <input type="number" id="productoPrecio" placeholder="0.00" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>Categor√≠a:</label>
                        <select id="productoCategoria">
                            <option value="bebidas">Bebidas</option>
                            <option value="panDulce">Pan Dulce</option>
                            <option value="panBlanco">Pan Blanco</option>
                            <option value="hogazas">Hogazas / Baguette</option>
                        </select>
                    </div>
                    <div class="form-buttons">
                        <button class="btn-cancelar" onclick="cancelarFormulario()">Cancelar</button>
                        <button class="btn-guardar" onclick="guardarProducto()">Guardar</button>
                    </div>
                </div>
                
                <div class="productos-lista" id="productosLista"></div>
            </div>
        </div>
    </div>

    <!-- Modal Efectivo -->
    <div id="modalEfectivo" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üíµ Pago en Efectivo</h2>
                <span class="modal-close" onclick="cerrarModalEfectivo()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="total-a-pagar">
                    <h3>Total a pagar: <span id="totalAPagar">$0.00</span></h3>
                </div>
                <h3 style="margin-bottom: 15px;">Selecciona con qu√© paga:</h3>
                <div class="billetes-grid">
                    <div class="billete" onclick="agregarDenominacion(500)">
                        <div class="billete-valor">$500</div>
                    </div>
                    <div class="billete" onclick="agregarDenominacion(200)">
                        <div class="billete-valor">$200</div>
                    </div>
                    <div class="billete" onclick="agregarDenominacion(100)">
                        <div class="billete-valor">$100</div>
                    </div>
                    <div class="billete" onclick="agregarDenominacion(50)">
                        <div class="billete-valor">$50</div>
                    </div>
                    <div class="billete" onclick="agregarDenominacion(20)">
                        <div class="billete-valor">$20</div>
                    </div>
                    <div class="moneda" onclick="agregarDenominacion(10)">
                        <div class="moneda-valor">$10</div>
                    </div>
                    <div class="moneda" onclick="agregarDenominacion(5)">
                        <div class="moneda-valor">$5</div>
                    </div>
                    <div class="moneda" onclick="agregarDenominacion(2)">
                        <div class="moneda-valor">$2</div>
                    </div>
                    <div class="moneda" onclick="agregarDenominacion(1)">
                        <div class="moneda-valor">$1</div>
                    </div>
                </div>
                <div class="monto-recibido-display">
                    <label>Monto recibido: <strong>$<span id="montoRecibidoDisplay">0.00</span></strong></label>
                    <input type="hidden" id="montoRecibido" value="0">
                    <button class="btn-resetear" onclick="resetearMonto()">Limpiar</button>
                </div>
                
                <div class="cambio-modal">
                    <h3>Cambio: <span id="cambioDisplay">0.00</span></h3>
                </div>
                
                <button class="btn-cerrar-venta" onclick="confirmarPagoEfectivo()">Cerrar Venta</button>
            </div>
        </div>
    </div>

    <!-- Modal Cambio -->
    <div id="modalCambio" class="modal hidden">
        <div class="modal-content modal-cambio">
            <div class="modal-body">
                <div class="cambio-info">
                    <h2 style="text-align: center; color: #28a745; margin-bottom: 20px;">‚úÖ Venta Completada</h2>
                    <div class="cambio-item">
                        <span>Total:</span>
                        <strong>$<span id="cambioTotal">0.00</span></strong>
                    </div>
                    <div class="cambio-item">
                        <span>Recibido:</span>
                        <strong>$<span id="cambioRecibido">0.00</span></strong>
                    </div>
                    <div class="cambio-item cambio-final">
                        <span>Cambio:</span>
                        <strong class="cambio-amount">$<span id="cambioMonto">0.00</span></strong>
                    </div>
                </div>
                <p style="text-align: center; color: #666; margin-top: 15px; font-size: 14px;">
                    Cerrando autom√°ticamente...
                </p>
            </div>
        </div>
    </div>

    <!-- Modal Venta Manual -->
    <div id="modalVentaManual" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí∞ Venta Manual</h2>
                <span class="modal-close" onclick="cerrarModalVentaManual()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Monto de la venta:</label>
                    <input type="number" id="montoVentaManual" placeholder="0.00" step="0.01" min="0" autofocus>
                </div>
                <div class="form-group">
                    <label>M√©todo de pago:</label>
                    <div style="display: flex; gap: 10px; margin-top: 10px;">
                        <button class="btn-pago" onclick="seleccionarMetodoVentaManual('tarjeta')" style="flex: 1;">üí≥ Tarjeta</button>
                        <button class="btn-pago" onclick="seleccionarMetodoVentaManual('efectivo')" style="flex: 1;">üíµ Efectivo</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Descripci√≥n (opcional):</label>
                    <textarea id="descripcionVentaManual" placeholder="Ej: Producto especial, pedido personalizado, etc." rows="2"></textarea>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Retiro -->
    <div id="modalRetiro" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üí∏ Retirar Efectivo</h2>
                <span class="modal-close" onclick="cerrarModalRetiro()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Monto a retirar:</label>
                    <input type="number" id="montoRetiro" placeholder="0.00" step="0.01" min="0">
                </div>
                <div class="form-group">
                    <label>Justificaci√≥n:</label>
                    <textarea id="justificacionRetiro" placeholder="Ej: Compra de insumos, pago a proveedor, etc." rows="3"></textarea>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button class="btn-cancelar" onclick="cerrarModalRetiro()" style="flex: 1;">Cancelar</button>
                    <button class="btn-guardar" onclick="confirmarRetiro()" style="flex: 1;">Confirmar Retiro</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            cargarDatosLocalStorage();
        });
    </script>
</body>
</html>
